{
    open Lexer

    let rec pow a = function
        | 0 -> 1
        | 1 -> a
        | n -> 
            let b = pow a (n / 2) in
            b * b * (if n mod 2 = 0 then 1 else a)
    ;;
}

%token<int> INT
%token PLUS MINUS SLASH STAR PERCENT CARET LPAREN RPAREN
%start expression

%%

expression:
    | l=expression PLUS  r=term { l + r }
    | l=expression MINUS r=term { l - r }
    | term                      { term }
;

term:
    | l=term STAR    r=factor { l * r }
    | l=term SLASH   r=factor { l / r }
    | l=term PERCENT r=factor { l mod r }
    | factor                  { factor }
;

factor:
    | l=base CARET r=factor { pow l r }
    | base                  { base }
;

base:
    | x=INT                    { x }
    | LPAREN expression RPAREN { expression }
;
